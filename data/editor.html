<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialDex - 配置编辑器</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            padding: 20px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #30363d;
        }
        h1 { color: #58a6ff; font-size: 24px; }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
        }
        .btn-primary {
            background: #238636;
            color: white;
        }
        .btn-secondary {
            background: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
        }
        .btn-danger {
            background: #da3633;
            color: white;
        }
        .editor {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .sidebar {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 15px;
        }
        .search-box {
            width: 100%;
            padding: 8px 12px;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            color: #c9d1d9;
            margin-bottom: 15px;
        }
        .author-list {
            max-height: 500px;
            overflow-y: auto;
        }
        .author-item {
            padding: 10px;
            margin-bottom: 5px;
            background: #21262d;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .author-item:hover { background: #30363d; }
        .author-item.active { background: #1f6feb; }
        .author-name { font-weight: 500; margin-bottom: 4px; }
        .author-tags { font-size: 12px; color: #8b949e; }
        .main {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #8b949e;
        }
        input[type="text"], select {
            width: 100%;
            padding: 10px 12px;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            color: #c9d1d9;
            font-size: 14px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #58a6ff;
        }
        .tags-select {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        .tag-option {
            padding: 6px 12px;
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            position: relative;
        }
        .tag-option.selected {
            background: #238636;
            border-color: #238636;
        }
        .tag-delete {
            margin-left: 6px;
            color: #f85149;
            font-weight: bold;
            font-size: 16px;
        }
        .tag-delete:hover {
            color: #da3633;
        }
        .new-tag-input {
            padding: 6px 10px;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 4px;
            color: #c9d1d9;
            font-size: 13px;
            width: 100px;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #8b949e;
        }
        .empty-state h3 {
            margin-bottom: 10px;
            color: #c9d1d9;
        }
        .file-input {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>SocialDex 配置编辑器</h1>
        <div>
            <input type="file" id="importFile" class="file-input" accept=".json">
            <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">导入配置</button>
            <button class="btn btn-primary" onclick="addNewAuthor()">+ 添加 UP 主</button>
            <button class="btn btn-primary" onclick="exportConfig()">导出配置</button>
        </div>
    </div>

    <div class="editor">
        <div class="sidebar">
            <input type="text" class="search-box" id="searchBox" placeholder="搜索 UP 主...">
            <div class="author-list" id="authorList"></div>
        </div>

        <div class="main" id="mainPanel">
            <div class="empty-state">
                <h3>选择一个 UP 主进行编辑</h3>
                <p>或点击"添加 UP 主"创建新配置</p>
            </div>
        </div>
    </div>

    <script>
        // 默认标签
        const DEFAULT_TAGS = ['知识', '法律', '游戏', '娱乐', '生活', '科技', '财经', '美食', '旅行', '音乐', '影视', '体育', '时尚', '汽车', '教育', '历史', '军事', '三农', '家居', '健康', '母婴', '宠物', '二次元', 'VUP'];

        // 数据存储
        let config = { authors: [] };
        let currentAuthorIndex = -1;

        // 从 localStorage 获取标签
        function getTags() {
            const stored = localStorage.getItem('socialdex_tags');
            if (stored) {
                return JSON.parse(stored);
            }
            // 首次使用，初始化默认标签
            localStorage.setItem('socialdex_tags', JSON.stringify(DEFAULT_TAGS));
            return DEFAULT_TAGS;
        }

        // 保存标签到 localStorage
        function saveTags(tags) {
            localStorage.setItem('socialdex_tags', JSON.stringify(tags));
        }

        // 初始化
        document.getElementById('importFile').addEventListener('change', importConfig);
        document.getElementById('searchBox').addEventListener('input', renderAuthorList);

        // 导入配置
        function importConfig(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    config = JSON.parse(event.target.result);
                    if (!config.authors) config.authors = [];
                    currentAuthorIndex = -1;
                    renderAuthorList();
                    renderMainPanel();
                } catch (err) {
                    console.error('配置文件格式错误', err);
                }
            };
            reader.readAsText(file);
        }

        // 导出配置
        function exportConfig() {
            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'config.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // 添加新 UP 主
        function addNewAuthor() {
            const newAuthor = {
                platform: 'bilibili',
                uid: '',
                name: '',
                tags: []
            };
            config.authors.push(newAuthor);
            currentAuthorIndex = config.authors.length - 1;
            renderAuthorList();
            renderMainPanel();
        }

        // 删除 UP 主
        function deleteAuthor(index) {
            if (confirm('确定删除这个 UP 主吗？')) {
                config.authors.splice(index, 1);
                if (currentAuthorIndex === index) {
                    currentAuthorIndex = -1;
                } else if (currentAuthorIndex > index) {
                    currentAuthorIndex--;
                }
                renderAuthorList();
                renderMainPanel();
            }
        }

        // 渲染作者列表
        function renderAuthorList() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const listEl = document.getElementById('authorList');
            listEl.innerHTML = '';

            config.authors.forEach((author, index) => {
                if (searchTerm && !author.name.toLowerCase().includes(searchTerm)) {
                    return;
                }

                const item = document.createElement('div');
                item.className = 'author-item' + (index === currentAuthorIndex ? ' active' : '');
                item.innerHTML = `
                    <div class="author-name">${author.name || '未命名'}</div>
                    <div class="author-tags">${author.tags.join(', ') || '无标签'} | UID: ${author.uid}</div>
                `;
                item.onclick = () => {
                    currentAuthorIndex = index;
                    renderAuthorList();
                    renderMainPanel();
                };
                listEl.appendChild(item);
            });
        }

        // 渲染主编辑区
        function renderMainPanel() {
            const mainEl = document.getElementById('mainPanel');

            if (currentAuthorIndex === -1) {
                mainEl.innerHTML = `
                    <div class="empty-state">
                        <h3>选择一个 UP 主进行编辑</h3>
                        <p>或点击"添加 UP 主"创建新配置</p>
                    </div>
                `;
                return;
            }

            const author = config.authors[currentAuthorIndex];
            const tags = getTags();

            mainEl.innerHTML = `
                <div class="form-group">
                    <label>平台</label>
                    <select id="platform" onchange="updateAuthor(${currentAuthorIndex}, 'platform', this.value)">
                        <option value="bilibili" ${author.platform === 'bilibili' ? 'selected' : ''}>哔哩哔哩</option>
                        <option value="douyin" ${author.platform === 'douyin' ? 'selected' : ''}>抖音</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>UID</label>
                    <input type="text" id="uid" value="${author.uid}"
                           onchange="updateAuthor(${currentAuthorIndex}, 'uid', this.value)">
                </div>

                <div class="form-group">
                    <label>名称</label>
                    <input type="text" id="name" value="${author.name}"
                           onchange="updateAuthor(${currentAuthorIndex}, 'name', this.value)">
                </div>

                <div class="form-group">
                    <label>标签（可多选）</label>
                    <div class="tags-select">
                        ${tags.map(tag => `
                            <span class="tag-option ${author.tags.includes(tag) ? 'selected' : ''}"
                                  onclick="toggleTag(${currentAuthorIndex}, '${tag}')">
                                ${tag}
                                <span class="tag-delete" onclick="event.stopPropagation(); deleteTag('${tag}')">×</span>
                            </span>
                        `).join('')}
                        <input type="text" id="newTagInput" class="new-tag-input" placeholder="新标签" onkeypress="if(event.key==='Enter') addNewTag()">
                        <button class="btn btn-secondary" onclick="addNewTag()">+</button>
                    </div>
                </div>

                <div class="form-group">
                    <button class="btn btn-danger" onclick="deleteAuthor(${currentAuthorIndex})">删除此 UP 主</button>
                </div>
            `;
        }

        // 更新作者字段
        function updateAuthor(index, field, value) {
            config.authors[index][field] = value;
            if (field === 'name') {
                renderAuthorList();
            }
        }

        // 切换标签
        function toggleTag(index, tag) {
            const author = config.authors[index];
            const tagIndex = author.tags.indexOf(tag);
            if (tagIndex === -1) {
                author.tags.push(tag);
            } else {
                author.tags.splice(tagIndex, 1);
            }
            renderAuthorList();
            renderMainPanel();
        }

        // 添加新标签
        function addNewTag() {
            const input = document.getElementById('newTagInput');
            const newTag = input.value.trim();

            if (!newTag) return;

            const tags = getTags();
            if (tags.includes(newTag)) return;

            tags.push(newTag);
            saveTags(tags);
            renderMainPanel();

            // 清空输入框并聚焦
            input.value = '';
            input.focus();
        }

        // 删除标签
        function deleteTag(tag) {
            let tags = getTags();
            tags = tags.filter(t => t !== tag);
            saveTags(tags);

            // 从所有 UP 主的标签中删除
            config.authors.forEach(author => {
                author.tags = author.tags.filter(t => t !== tag);
            });

            renderAuthorList();
            renderMainPanel();
        }

        // 初始渲染
        renderAuthorList();
        renderMainPanel();
    </script>
</body>
</html>
